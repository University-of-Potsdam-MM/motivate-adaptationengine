<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: rules/RuleEngine.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"MOTIVATE Adaptation Engine","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">MOTIVATE Adaptation Engine</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="AdaptationEngine">
            <span class="title">
                <a href="AdaptationEngine.html">AdaptationEngine</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="AdaptationEngine#isRunning"><a href="AdaptationEngine.html#isRunning">isRunning</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li data-name="AdaptationEngine~preloadLearningUnitCallback"><a href="AdaptationEngine.html#preloadLearningUnitCallback">preloadLearningUnitCallback</a></li>
            
                <li data-name="AdaptationEngine~restrictFeatureCallback"><a href="AdaptationEngine.html#restrictFeatureCallback">restrictFeatureCallback</a></li>
            
                <li data-name="AdaptationEngine~ruleMatchingErrorCallback"><a href="AdaptationEngine.html#ruleMatchingErrorCallback">ruleMatchingErrorCallback</a></li>
            
                <li data-name="AdaptationEngine~ruleMatchingSuccessCallback"><a href="AdaptationEngine.html#ruleMatchingSuccessCallback">ruleMatchingSuccessCallback</a></li>
            
                <li data-name="AdaptationEngine~selectLearningUnitCallback"><a href="AdaptationEngine.html#selectLearningUnitCallback">selectLearningUnitCallback</a></li>
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="AdaptationEngine#restartRuleMatching"><a href="AdaptationEngine.html#restartRuleMatching">restartRuleMatching</a></li>
            
                <li data-name="AdaptationEngine#setPreloadLearningUnitCallback"><a href="AdaptationEngine.html#setPreloadLearningUnitCallback">setPreloadLearningUnitCallback</a></li>
            
                <li data-name="AdaptationEngine#setRestrictFeatureCallback"><a href="AdaptationEngine.html#setRestrictFeatureCallback">setRestrictFeatureCallback</a></li>
            
                <li data-name="AdaptationEngine#setRuleMatchingErrorCallback"><a href="AdaptationEngine.html#setRuleMatchingErrorCallback">setRuleMatchingErrorCallback</a></li>
            
                <li data-name="AdaptationEngine#setRuleMatchingSuccessCallback"><a href="AdaptationEngine.html#setRuleMatchingSuccessCallback">setRuleMatchingSuccessCallback</a></li>
            
                <li data-name="AdaptationEngine#setSelectLearningUnitCallback"><a href="AdaptationEngine.html#setSelectLearningUnitCallback">setSelectLearningUnitCallback</a></li>
            
                <li data-name="AdaptationEngine#startRuleMatching"><a href="AdaptationEngine.html#startRuleMatching">startRuleMatching</a></li>
            
                <li data-name="AdaptationEngine#stopRuleMatching"><a href="AdaptationEngine.html#stopRuleMatching">stopRuleMatching</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ContextDetector">
            <span class="title">
                <a href="ContextDetector.html">ContextDetector</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ContextDetector#addContextInformation"><a href="ContextDetector.html#addContextInformation">addContextInformation</a></li>
            
                <li data-name="ContextDetector#contextInformationExists"><a href="ContextDetector.html#contextInformationExists">contextInformationExists</a></li>
            
                <li data-name="ContextDetector#getContextInformation"><a href="ContextDetector.html#getContextInformation">getContextInformation</a></li>
            
                <li data-name="ContextDetector#setCallback"><a href="ContextDetector.html#setCallback">setCallback</a></li>
            
                <li data-name="ContextDetector#updateContextInformation"><a href="ContextDetector.html#updateContextInformation">updateContextInformation</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="ContextInformation">
            <span class="title">
                <a href="ContextInformation.html">ContextInformation</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="ContextInformation.fromFact"><a href="ContextInformation.html#fromFact">fromFact</a></li>
            
                <li data-name="ContextInformation#description"><a href="ContextInformation.html#description">description</a></li>
            
                <li data-name="ContextInformation#equals"><a href="ContextInformation.html#equals">equals</a></li>
            
                <li data-name="ContextInformation#getID"><a href="ContextInformation.html#getID">getID</a></li>
            
                <li data-name="ContextInformation#getParameter"><a href="ContextInformation.html#getParameter">getParameter</a></li>
            
                <li data-name="ContextInformation#getParameterValue"><a href="ContextInformation.html#getParameterValue">getParameterValue</a></li>
            
                <li data-name="ContextInformation#getValue"><a href="ContextInformation.html#getValue">getValue</a></li>
            
                <li data-name="ContextInformation#setID"><a href="ContextInformation.html#setID">setID</a></li>
            
                <li data-name="ContextInformation#setParameters"><a href="ContextInformation.html#setParameters">setParameters</a></li>
            
                <li data-name="ContextInformation#setParameterValue"><a href="ContextInformation.html#setParameterValue">setParameterValue</a></li>
            
                <li data-name="ContextInformation#setValue"><a href="ContextInformation.html#setValue">setValue</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="RuleEngine">
            <span class="title">
                <a href="RuleEngine.html">RuleEngine</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="RuleEngine#addContextInformation"><a href="RuleEngine.html#addContextInformation">addContextInformation</a></li>
            
                <li data-name="RuleEngine#getDefined"><a href="RuleEngine.html#getDefined">getDefined</a></li>
            
                <li data-name="RuleEngine#getRules"><a href="RuleEngine.html#getRules">getRules</a></li>
            
                <li data-name="RuleEngine#matchRules"><a href="RuleEngine.html#matchRules">matchRules</a></li>
            
                <li data-name="RuleEngine#setCallback"><a href="RuleEngine.html#setCallback">setCallback</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="RuleEngine.js.html">Source: rules/RuleEngine.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>define("MoRE", ['nools', 'easejs', 'MoCI'], function (nools, easejs, ContextInformation) {
    var Class = easejs.Class;

    var RuleEngine = Class('RuleEngine',
        {
            'private _nools': null,
            'private _flow': null,
            'private _parsedFlow': null,
            'private _session': null,
            'private _callbacks': {
                "ruleMatchingSuccessCallback": function() {
                    console.log("done");
                },
                "ruleMatchingErrorCallback": function(err) {
                    console.error(err.stack);
                }
            },

            /**
             * The rule engine encapsulates the nools.js rule engine.
             * @class RuleEngine
             * @constructs RuleEngine
             * @param noolsDSL {string} The adaptation rules formated in nools DSL as provided by the rule generator.
             */
            __construct: function(noolsDSL)
            {
                var that = this;

                this._nools = require("nools");
                this._parsedFlow = this._nools.parse(noolsDSL);
                this._flow = this._nools.compile(noolsDSL, {name: "adaptationRules"});
                this._session = this._flow.getSession();

                this._session.on("restrictFeature", function(feature, facts){
                    if (typeof that._callbacks["restrictFeatureCallback"] != "undefined") {
                        that._callbacks["restrictFeatureCallback"](feature, that._contextInformationFromFacts(facts));
                    }
                });

                this._session.on("selectLearningUnit", function(id, facts){
                    if (typeof that._callbacks["selectLearningUnitCallback"] != "undefined") {
                        that._callbacks["selectLearningUnitCallback"](id, that._contextInformationFromFacts(facts));
                    }
                });

                this._session.on("preloadLearningUnit", function(id){
                    if (typeof that._callbacks["preloadLearningUnitCallback"] != "undefined") {
                        that._callbacks["preloadLearningUnitCallback"](id);
                    }
                });
            },

            'private _contextInformationFromFacts': function(facts) {
                var contextInformation = [];
                for(index in facts) {
                    var fact = facts[index];
                    contextInformation.push(ContextInformation.fromFact(fact));
                }
                return contextInformation;
            },

            /**
             * Sets a function as the callback for the provided callback name.
             * @alias setCallback
             * @memberof RuleEngine#
             * @param callbackName {string} The name of the callback.
             * @param callback {function} The function that handles the callback.
             */
            'public setCallback': function(callbackName, callback) {
                this._callbacks[callbackName] = callback;
            },

            /**
             * Returns the rules that are part of the current nools flow.
             * @alias getRules
             * @memberof RuleEngine#
             * @returns {*|Array}
             */
            'public getRules': function() {
                return this._parsedFlow.rules;
            },

            /**
             * Starts the nools rule matching and triggers callbacks for success or errors.
             * @alias matchRules
             * @memberof RuleEngine#
             */
            'public matchRules': function() {
                var that = this;

                // modify all facts so that rules will fire even when there are no new context information
                // might be unnecessary in the future because context information will likely be changing all the time
                var facts = this._session.getFacts();
                for(index in facts) {
                    var fact = facts[index];
                    this._session.modify(fact);
                }

                console.log("matching...");
                this._session.match(function(err) {
                   if (err) {
                       that._callbacks["ruleMatchingErrorCallback"](err);
                   } else {
                       that._callbacks["ruleMatchingSuccessCallback"]();
                   }
                });
            },

            'private _addFact': function(fact) {
                this._session.assert(fact);
            },

            /**
             * Adds a context information as fact to the current nools session.
             * @alias addContextInformation
             * @memberof RuleEngine#
             * @param contextInformation
             */
            'public addContextInformation': function(contextInformation) {
                //TODO: add context information directly from context detection and convert to flow context information
                //FlowContextInformation = this.getDefined("ContextInformation");
                //TODO: test if context information already exists
                if (false) {

                } else {
                    this._addFact(contextInformation);
                }
            },

            /**
             * Returns the nools class definition with the provided name.
             * @alias getDefined
             * @memberof RuleEngine#
             * @param definitionName
             * @returns {*}
             */
            'public getDefined': function(definitionName) {
                return this._flow.getDefined(definitionName);
            }
        }
    );

    return RuleEngine;
});</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Oct 21 2014 14:18:37 GMT+0200 (MESZ)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
